apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
    name: homepage
    namespace: homepage
spec:
    interval: 15m
    chart:
        spec:
            chart: homepage
            version: 9.3.4
            sourceRef:
                kind: HelmRepository
                name: truecharts
                namespace: flux-system
    values:
        configmap:
            config:
                data:
                    bookmarks.yaml: |
                        ---
                        # https://gethomepage.dev/latest/configs/bookmarks
                        - Developer:
                            - Github:
                                - abbr: GH
                                  href: https://github.com/
                        - Social:
                            - Reddit:
                                - abbr: RE
                                  href: https://reddit.com/
                        - Entertainment:
                            - YouTube:
                                - abbr: YT
                                  href: https://youtube.com/
                        - TrueCharts:
                            - TrueCharts:
                              - abbr: TC
                                icon: https://truecharts.org/svg/favicon.svg
                                href: https://truecharts.org
                                description: "TrueCharts Website"
                            - Github:
                              - abbr: GH
                                icon: https://github.com/fluidicon.png
                                href: https://github.com/truecharts
                                description: "TrueCharts GitHub"
                            - Open Collective:
                              - abbr: TC
                                icon: https://opencollective.com/favicon.ico
                                href: https://opencollective.com/truecharts
                                description: "TrueCharts Open Collective"
                            - Discord:
                              - abbr: DC
                                icon: https://t2.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=http://discord.com&size=32
                                href: https://truecharts.org/s/discord
                                description: "TrueCharts Discord"
                    custom.css: ""
                    custom.js: ""
                    kubernetes.yaml: |
                        mode: cluster
                    services.yaml: "---\n# For configuration options and examples, please see:\n# https://gethomepage.dev/latest/configs/services\n\n- Arr:\n    - My First Service:\n        href: http://localhost/\n        description: Homepage is awesome\n\n- Media:\n    - My Second Service:\n        href: http://localhost/\n        description: Homepage is the best\n\n- Infra:\n    - My Third Service:\n        href: http://localhost/\n        description: Homepage is \U0001F60E\n"
                    settings.yaml: |
                        ---
                        # https://gethomepage.dev/latest/configs/settings
                        providers:
                          openweathermap: '${OPENWEATHERMAP_API_KEY}'
                    widgets.yaml: |
                        ---
                        # https://gethomepage.dev/latest/configs/widgets
                        - resources:
                            cpu: true
                            memory: true
                            disk: /
                        - search:
                            provider: duckduckgo
                            target: _blank
                enabled: true
        credentials:
            backblaze:
                name: backblaze
                type: s3
                path: ""
                accessKey: "${BACKBLAZE_ID}"
                bucket: "${BACKBLAZE_BUCKET}"
                encrKey: "${BACKBLAZE_ENCR_KEY}"
                secretKey: "${BACKBLAZE_KEY}"
                url: "${BACKBLAZE_URL}"
        forceConfigFromValues: false
        ingress:
            main:
                enabled: true
                hosts:
                    - host: "home.${DOMAIN_0}"
                      paths:
                        - path: /
                          pathType: Prefix
                integrations:
                    certManager:
                        enabled: true
                        certificateIssuer: domain-0-le-prod
                    traefik:
                        enabled: true
                        entrypoints:
                            - websecure
                        # middlewares:
                        #     - name: auth
                        #       namespace: ""
        persistence:
            config:
                enabled: true
                readOnly: false
                mountPath: /app/config
                volsync:
                    - name: config
                      credentials: backblaze
                      type: restic
                      dest:
                        enabled: true
                      src:
                        enabled: false
